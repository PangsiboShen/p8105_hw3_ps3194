---
title: "p8105_hw3_ps3194"
author: "Pangsibo Shen"
date: "10/9/2020"
output: github_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 1

```{r}
data("instacart")
```

###### how many aisles, and which are most items from?

```{r}
instacart %>%
  count(aisle) %>%
  arrange(desc(n))
```

###### Let's make a plot

```{r}
instacart %>%
  count(aisle) %>%
  filter(n > 10000) %>%
  mutate(
    aisle = factor(aisle),
    aisle = fct_reorder(aisle, n)
  ) %>%
  ggplot(aes(x = aisle, y = n)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```
###### Let's make a table!
```{r}
instacart %>%
  filter(aisle %in% c("baking ingredients","dog food care", "packaged vegetables fruits")) %>%
  group_by(aisle) %>%
  count(product_name) %>%
  mutate(rank = min_rank(desc(n))) %>%
  filter(rank < 4) %>%
  arrange(aisle, rank) %>%
  knitr::kable()
```

###### Apples vs ice cream.

```{r}
instacart %>%
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarise(mean_hour = mean(order_hour_of_day)) %>%
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  )
```

## Problem 2

###### load and tidy the data
```{r accel}
accel = read_csv("./data/accel_data.csv") %>%
  janitor::clean_names() %>%
  pivot_longer(
    activity_1:activity_1440,
    names_to = "minute",
    names_prefix = "activity_",
    values_to = "activity_count"
  ) %>%
  transform(
    minute = as.numeric(minute),
    #day = as_factor(day),
    week = as.factor(week)
  ) %>%
  mutate(weekday = case_when(
    day %in% c("Monday","Tuesday","Wednesday","Thursday","Friday") ~ "weekday",
    day %in% c("Saturday","Sunday") ~ "weekend")
  ) %>%
  transform(
    weekday = as.factor(weekday)
  )
 

head(accel)

```

The resulting dataset has 6 variables: week, day_id, day, minute, activity_count and weekday. The weekday variable has two levels: weekday and weekend. There are `r nrow(accel)` observations from the dataset.

###### relevel the day variable to chronological order
```{r relevel}
accel$day = factor(accel$day, c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
```

###### create a table showing the sum count for each day
```{r table}
accel %>%
  group_by(week, day_id, day) %>%
  summarise(
    sum_count = sum(activity_count)
  ) %>%
  arrange(week,day) %>%
  knitr::kable(align = 'c')
```
For the first weeks, the patient's daily total activity counts generally had increased from Monday to Sunday.For week 4, the patient's daily total activity counts had decreased from Monday to Saturday. For week 5, the patient's daily total activity counts had increased from Monday to Friday.

###### plot showing 24 hour activity
```{r}
accel = accel %>%
  mutate(hour = case_when(
    minute %in% 1:60 ~ 1,
    minute %in% 61:120 ~ 2,
    minute %in% 121:180 ~ 3,
    minute %in% 181:240 ~ 4,
    minute %in% 241:300 ~ 5,
    minute %in% 301:360 ~ 6,
    minute %in% 361:420 ~ 7,
    minute %in% 421:480 ~ 8,
    minute %in% 481:540 ~ 9,
    minute %in% 541:600 ~ 10,
    minute %in% 601:660 ~ 11,
    minute %in% 661:720 ~ 12,
    minute %in% 721:800 ~ 13,
    minute %in% 801:860 ~ 14,
    minute %in% 861:920 ~ 15,
    minute %in% 921:980 ~ 16,
    minute %in% 981:1040 ~ 17,
    minute %in% 1041:1100 ~ 18,
    minute %in% 1101:1160 ~ 19,
    minute %in% 1161:1200 ~ 20,
    minute %in% 1201:1260 ~ 21,
    minute %in% 1261:1320 ~ 22,
    minute %in% 1321:1380 ~ 23,
    minute %in% 1381:1440 ~ 24,
    )) %>%
  group_by(week, day_id, day, hour) %>%
  summarise(
    hour_count = sum(activity_count)
  )

head(accel)

```

```{r}
accel %>%
  ggplot(aes(x = hour, y = hour_count, fill = day, color = week)) +
  geom_line(alpha = 0.3) +
  scale_x_continuous(breaks = accel$hour) + 
  ylab("hourly activity count") +
  guides(fill = guide_legend(title = "Week")) 
  #facet_grid(week ~.)
```

## Problem 3
load dataset
```{r}
data("ny_noaa")
```
